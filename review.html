<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>評分頁面</title>

<!-- Common links -->
<!----><link rel="icon" type="image/png" href="include/icon.png" />
<!----><script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!----><script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.19.min.js"></script>
<!----><script type="text/javascript" src="js/checkUser.js" ></script>
        <link href="bootstrap/css/bootstrap.css" rel="stylesheet" />
 
<!----<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
<!----><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<!----><link href="css/all.css" rel="stylesheet" />
<!----><script src="js/all.js"></script>
<!---------------------->

<script src="http://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js" type="text/javascript" charset="utf-8"></script>

<link rel="stylesheet" href="css/bug.css">
<link rel="stylesheet" href="css/review.css">

</head>
<body>
<div class="container-fluid">
<div class="modal fade" id="report">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">回報作業問題</h4>
      </div>
      <div class="modal-body">
        <p>發生了什麼事情</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</div>


<style>
nav {
	
}
</style>
<script src="js/include/nav.js"></script>
<script>

</script>
<script type="text/javascript" src="js/include/schedule.js"></script>

<div class=" container-fluid">
<!-- Nav tabs -->
<div class="nav-row row" style="position:relative;">
<ul id="review-tab" class="nav nav-tabs col-md-12" role="tablist">
  <li class="title disabled"><a>Assign</a></li>
	<li class="tab active">
			<a href="#assign0" role="tab" data-toggle="tab">#1 <div class="badge grade-preview"></div> <span class="glyphicon glyphicon-star preview hidden"></span></a></li>
  <li class="tab"><a href="#assign1" role="tab" data-toggle="tab">#2 <span class="badge grade-preview"></span> <span class="glyphicon glyphicon-star preview hidden"></span></a></li>
  <li class="tab"><a href="#assign2" role="tab" data-toggle="tab">#3 <span class="badge grade-preview"></span> <span class="glyphicon glyphicon-star preview hidden"></span></a></li>
  <li class="tab"><a href="#assign3" role="tab" data-toggle="tab">#4 <span class="badge grade-preview"></span> <span class="glyphicon glyphicon-star preview hidden"></span></a></li>
  <li class="tab"><a href="#assign4" role="tab" data-toggle="tab">#5 <span class="badge grade-preview"></span> <span class="glyphicon glyphicon-star preview hidden"></span></a></li>
</ul>
<div class="control-area col-md-6">

	<div id="requirement-btn"  class="btn" style="color:rgba(212,211,211,1.00);">評分標準<!--span class="glyphicon glyphicon-list"></span--></div>
	<div id="help-review-btn"  class="btn" style="color:rgba(212,211,211,1.00);">如何評分<!--span class="glyphicon glyphicon-question-sign"></span--></div>
	<!--button id="save-grade-btn" type="button" class="btn btn-info"><span class="glyphicon glyphicon-save"></span></button-->

	<button id="review-submit" type="button" class="btn btn-danger btn-lg" onClick="submitReview();"><span class="glyphicon glyphicon-send"></span> 繳交評分結果</button>

</div>
</div>
</div>
<!-- Tab panes -->

<div class="tab-content container-fluid ">
	<!--- next tab --->
  <div  class="tab-pane fade in active" id="assign0">
		<div class="row showPane">
			<div class="play col-xs-7"></div>
			<div class="editor-container col-xs-5">
				<div class="editor"></div>
			</div>
		</div>
		<div class="grading-pane col-xs-7">
			<div style="width:40%;">
			<select class=" grade grade-select form-control input-md" >
				<option value="-">選取評等</option>
				<option>A</option>
				<option>B</option>
				<option>C</option>
				<option>X</option>
			</select>
			</div>
			<div class="checkbox" >
				<label style="padding-left:0">
					<button type="button" class="btn btn-default star-btn "><span class="glyphicon glyphicon-star"></span> </button>
					<input class="grade star" type="radio" name="star"  />
				</label>
			</div>
		<div>
				<button type="button" class="report-btn btn btn-default " data-toggle="modal" data-target="#report"><span class="glyphicon glyphicon-flag"></span></button>
			</div> 
		</div>

<h3 class="bug-block-title">遊戲霸個回報區</h3>
<div class="container">
	<div id="add" class="add-bug bug	"> 
		<form class="add-bug-form" >
			<div class="media" style="background:none; border:none;">
				<a class="pull-left">
					<div class="add-bug-img media-object view-bug-img" ></div>
					<input type="file" class="add-img-input hidden" />	
				</a>
				<div class="pull-right">
					<div class="bug-func-btns">
						<a  class="submit-bug bug-func-btn bug-func-btn-lg"  data-toggle="tooltip" data-placement="left" title="呈交霸個" > <span class="glyphicon glyphicon-upload"></span></a>
					</div>
				</div>
				<div class="media-body view-bug-des add-bug-des" >
					<textarea style="border:none; resize:none;"  class="add-des-input" placeholder="敘述請包含時間點與問題描述，內容至少十個字以上" ></textarea>
				</div>
			</div>
		</form>
	</div>
</div>
<div class="container bug-pane">
</div>

</div><!--這是很厲害的 tab-pane 結尾！！-->

	<!--- next tab --->
  <div  class="tab-pane fade in" id="assign1">
		<div class="row showPane">
			<div class="play col-xs-7"></div>
			<div class="editor-container col-xs-5">
				<div class="editor"></div>
			</div>
		</div>
		<div class="grading-pane col-xs-7">
			<div style="width:40%;">
			<select class=" grade grade-select form-control input-md" >
				<option value="-">選取評等</option>
				<option>A</option>
				<option>B</option>
				<option>C</option>
				<option>X</option>
			</select>
			</div>
			<div class="checkbox" >
				<label style="padding-left:0">
					<button type="button" class="btn btn-default star-btn "><span class="glyphicon glyphicon-star"></span> </button>
					<input class="grade star" type="radio" name="star"  />
				</label>
			</div>
		<div>
				<button type="button" class="report-btn btn btn-default " data-toggle="modal" data-target="#report"><span class="glyphicon glyphicon-flag"></span></button>
			</div> 
		</div>

<h3 class="bug-block-title">遊戲霸個回報區</h3>
<div class="container">
	<div id="add" class="add-bug bug	"> 
		<form class="add-bug-form" >
			<div class="media" style="background:none; border:none;">
				<a class="pull-left">
					<div class="add-bug-img media-object view-bug-img" ></div>
					<input type="file" class="add-img-input hidden" />	
				</a>
				<div class="pull-right">
					<div class="bug-func-btns">
						<a  class="submit-bug bug-func-btn bug-func-btn-lg"  data-toggle="tooltip" data-placement="left" title="呈交霸個" > <span class="glyphicon glyphicon-upload"></span></a>
					</div>
				</div>
				<div class="media-body view-bug-des add-bug-des" >
					<textarea style="border:none; resize:none;"  class="add-des-input" placeholder="敘述請包含時間點與問題描述，內容至少十個字以上" ></textarea>
				</div>
			</div>
		</form>
	</div>
</div>
<div class="container bug-pane">
</div>

</div><!--這是很厲害的 tab-pane 結尾！！-->

	<!--- next tab --->
  <div  class="tab-pane fade in" id="assign2">
		<div class="row showPane">
			<div class="play col-xs-7"></div>
			<div class="editor-container col-xs-5">
				<div class="editor"></div>
			</div>
		</div>
		<div class="grading-pane col-xs-7">
			<div style="width:40%;">
			<select class=" grade grade-select form-control input-md" >
				<option value="-">選取評等</option>
				<option>A</option>
				<option>B</option>
				<option>C</option>
				<option>X</option>
			</select>
			</div>
			<div class="checkbox" >
				<label style="padding-left:0">
					<button type="button" class="btn btn-default star-btn "><span class="glyphicon glyphicon-star"></span> </button>
					<input class="grade star" type="radio" name="star"  />
				</label>
			</div>
		<div>
				<button type="button" class="report-btn btn btn-default " data-toggle="modal" data-target="#report"><span class="glyphicon glyphicon-flag"></span></button>
			</div> 
		</div>

<h3 class="bug-block-title">遊戲霸個回報區</h3>
<div class="container">
	<div id="add" class="add-bug bug	"> 
		<form class="add-bug-form" >
			<div class="media" style="background:none; border:none;">
				<a class="pull-left">
					<div class="add-bug-img media-object view-bug-img" ></div>
					<input type="file" class="add-img-input hidden" />	
				</a>
				<div class="pull-right">
					<div class="bug-func-btns">
						<a  class="submit-bug bug-func-btn bug-func-btn-lg"  data-toggle="tooltip" data-placement="left" title="呈交霸個" > <span class="glyphicon glyphicon-upload"></span></a>
					</div>
				</div>
				<div class="media-body view-bug-des add-bug-des" >
					<textarea style="border:none; resize:none;"  class="add-des-input" placeholder="敘述請包含時間點與問題描述，內容至少十個字以上" ></textarea>
				</div>
			</div>
		</form>
	</div>
</div>
<div class="container bug-pane">
</div>

</div><!--這是很厲害的 tab-pane 結尾！！-->




	<!--- next tab --->
  <div  class="tab-pane fade in" id="assign3">
		<div class="row showPane">
			<div class="play col-xs-7"></div>
			<div class="editor-container col-xs-5">
				<div class="editor"></div>
			</div>
		</div>
		<div class="grading-pane col-xs-7">
			<div style="width:40%;">
			<select class=" grade grade-select form-control input-md" >
				<option value="-">選取評等</option>
				<option>A</option>
				<option>B</option>
				<option>C</option>
				<option>X</option>
			</select>
			</div>
			<div class="checkbox" >
				<label style="padding-left:0">
					<button type="button" class="btn btn-default star-btn "><span class="glyphicon glyphicon-star"></span> </button>
					<input class="grade star" type="radio" name="star"  />
				</label>
			</div>
		<div>
				<button type="button" class="report-btn btn btn-default " data-toggle="modal" data-target="#report"><span class="glyphicon glyphicon-flag"></span></button>
			</div> 
		</div>

<h3 class="bug-block-title">遊戲霸個回報區</h3>
<div class="container">
	<div id="add" class="add-bug bug	"> 
		<form class="add-bug-form" >
			<div class="media" style="background:none; border:none;">
				<a class="pull-left">
					<div class="add-bug-img media-object view-bug-img" ></div>
					<input type="file" class="add-img-input hidden" />	
				</a>
				<div class="pull-right">
					<div class="bug-func-btns">
						<a  class="submit-bug bug-func-btn bug-func-btn-lg"  data-toggle="tooltip" data-placement="left" title="呈交霸個" > <span class="glyphicon glyphicon-upload"></span></a>
					</div>
				</div>
				<div class="media-body view-bug-des add-bug-des" >
					<textarea style="border:none; resize:none;"  class="add-des-input" placeholder="敘述請包含時間點與問題描述，內容至少十個字以上" ></textarea>
				</div>
			</div>
		</form>
	</div>
</div>
<div class="container bug-pane">
</div>

</div><!--這是很厲害的 tab-pane 結尾！！-->

	<!--- next tab --->
  <div  class="tab-pane fade in" id="assign4">
		<div class="row showPane">
			<div class="play col-xs-7"></div>
			<div class="editor-container col-xs-5">
				<div class="editor"></div>
			</div>
		</div>
		<div class="grading-pane col-xs-7">
			<div style="width:40%;">
			<select class=" grade grade-select form-control input-md" >
				<option value="-">選取評等</option>
				<option>A</option>
				<option>B</option>
				<option>C</option>
				<option>X</option>
			</select>
			</div>
			<div class="checkbox" >
				<label style="padding-left:0">
					<button type="button" class="btn btn-default star-btn "><span class="glyphicon glyphicon-star"></span> </button>
					<input class="grade star" type="radio" name="star"  />
				</label>
			</div>
		<div>
				<button type="button" class="report-btn btn btn-default " data-toggle="modal" data-target="#report"><span class="glyphicon glyphicon-flag"></span></button>
			</div> 
		</div>

<h3 class="bug-block-title">遊戲霸個回報區</h3>
<div class="container">
	<div id="add" class="add-bug bug	"> 
		<form class="add-bug-form" >
			<div class="media" style="background:none; border:none;">
				<a class="pull-left">
					<div class="add-bug-img media-object view-bug-img" ></div>
					<input type="file" class="add-img-input hidden" />	
				</a>
				<div class="pull-right">
					<div class="bug-func-btns">
						<a  class="submit-bug bug-func-btn bug-func-btn-lg"  data-toggle="tooltip" data-placement="left" title="呈交霸個" > <span class="glyphicon glyphicon-upload"></span></a>
					</div>
				</div>
				<div class="media-body view-bug-des add-bug-des" >
					<textarea style="border:none; resize:none;"  class="add-des-input" placeholder="敘述請包含時間點與問題描述，內容至少十個字以上" ></textarea>
				</div>
			</div>
		</form>
	</div>
</div>
<div class="container bug-pane">
</div>

</div><!--這是很厲害的 tab-pane 結尾！！-->






</div>



<script type="text/javascript" src="js/bug.js"></script>
<script type="text/javascript" src="js/review.js"></script>
<script>






$(document).on('click' ,".submit-bug",function (e){
	//Rn!!!!!!!!!	
	//檢查BUg 是否新增完成	
	e.preventDefault();
	//console.log ("true");
	var $p = $(this).closest(".tab-pane") ;
	var i = $p.index();
	var form = $p.find(".add-bug-form").get(0);;
	var $img = $p.find(".add-img-input").first();
	var $preImg = $p.find(".add-bug-img").first();
	var base64 = $preImg.data("base64");
	var $btn = $p.find(".submit-bug").first();
	var des = $p.find(".add-des-input").first().val();
	var reviewRecord = AssignArr[i];
	var assign = reviewRecord.get("assign");
	var reporter = currentUser ;
	var bugger = assign.get("maker");
	
	var fileUploadControl = $img[0];
	
	if(des.length < 10 ){ 
		alert("你的描述太過精簡，請至少超過十個字。"); 
		return false ;
	}
	
	if (fileUploadControl.files.length > 0) {
		if (Validate(form)){
			$btn.attr("disabled","disabled");
			$btn.addClass('disabled');
			var BugRecord = Parse.Object.extend("Bug_Record");
			var bugRecord = new BugRecord();
		
			var file = fileUploadControl.files[0];
			var name = file.name;
			var bugImg = new Parse.File("Bug",{base64:base64});
			
			//http://stackoverflow.com/questions/4459379/preview-an-image-before-it-is-uploaded
			bugImg.save().then(function(img){
				console.log(img);
				bugRecord.set("reporter",reporter);
				bugRecord.set("assign",assign);
				bugRecord.set("bugger",bugger);
				bugRecord.set("img",img);
				bugRecord.set("des",des);
				return bugRecord.save();
			}).then (function(bugRecord){
				alert("BUG舉報成功，請等待作者確認");
				console.log("舉報成功後",bugRecord , i );
				showBug(bugRecord, i);
				controlAllBugView();
				controlAllStepView ();

				$p.find(".add-bug-form").trigger('reset');
				$preImg.removeAttr("style");
				$btn.removeClass('disabled');
				$btn.removeAttr("disabled");
			},function(e){console.log(e);});
		}else { // file is not image;
			$img.trigger('click');
		}
	}else { // if 沒有點選附檔
		alert("請附上Bug圖片");
	}
	return false ;
});






</script>

<script type="text/javascript" src="js/include/students.js"></script>





</body>
</html>
